<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerenciador de Tarefas</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <div class="container">
        <h1>Minhas Tarefas</h1>
      </div>
    </header>

    <main>
      <div class="container">
        <div id="messageContainer" class="message"></div>

        <div id="taskOptionContainer" class="options">
          <label>
            <input
              type="radio"
              id="newTaskOption"
              name="taskType"
              value="newTask"
              checked
            />
            Digitar Nova Tarefa
          </label>
          <label>
            <input
              type="radio"
              id="createShoppingListOption"
              name="taskType"
              value="shoppingList"
            />
            Criar Lista de Compras
          </label>
        </div>

        <form id="task-form" class="form-section">
          <div class="task-form-content" id="addTaskFormContent">
            <input
              type="text"
              id="task-title"
              placeholder="Título da Tarefa"
              required
            />
            <textarea
              id="task-description"
              placeholder="Descrição (opcional)"
            ></textarea>
          </div>

          <fieldset class="form-fieldset">
            <legend>Selecione o status da tarefa:</legend>
            <select id="task-status" class="task-form-select">
              <option value="Pendente">Pendente</option>
              <option value="Em Progresso">Em Progresso</option>
              <option value="Concluído">Concluído</option>
            </select>
            <button type="submit" id="addTaskBtn" class="primary-button">
              Adicionar Tarefa
            </button>
          </fieldset>
        </form>

        <div
          id="shoppingListContainer"
          class="form-section"
          style="display: none"
        >
          <label>Selecione os itens para a lista de compras:</label>
          <div id="shoppingListCheckboxes" class="checkbox-list"></div>
        </div>

        <form id="updateForm" class="form-section" style="display: none">
          <h2>Atualizar Tarefa</h2>
          <input type="hidden" id="updateTaskId" />
          <label for="updateTitle">Título:</label>
          <input
            type="text"
            id="updateTitle"
            class="task-form-input"
            required
          />

          <label for="updateDescription">Descrição:</label>
          <textarea
            id="updateDescription"
            rows="3"
            class="task-form-input"
          ></textarea>

          <label for="updateStatus">Status:</label>
          <select id="updateStatus" class="task-form-select">
            <option value="Pendente">Pendente</option>
            <option value="Em Progresso">Em Progresso</option>
            <option value="Concluído">Concluído</option>
          </select>

          <button type="submit" id="saveUpdateBtn" class="primary-button">
            Salvar Alterações
          </button>
          <button type="button" id="cancelUpdate" class="secondary-button">
            Cancelar
          </button>
        </form>

        <div class="tasks-list-section">
          <h2>Lista de Tarefas</h2>
          <ul id="task-list" class="task-list"></ul>
        </div>
      </div>
    </main>

    <footer>
      <div class="container">
        <p>&copy; 2025 Gerenciador de Tarefas. Todos os direitos reservados.</p>
      </div>
    </footer>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
      // Função para carregar a API do Apps Script de forma assíncrona
      function loadAppsScriptAPI(url) {
        return new Promise((resolve, reject) => {
          const script = document.createElement("script");
          script.src = url;
          script.onload = () => {
            if (
              typeof google !== "undefined" &&
              google.script &&
              google.script.run
            ) {
              resolve();
            } else {
              reject(
                new Error(
                  "google.script.run não está disponível após carregar o script."
                )
              );
            }
          };
          script.onerror = () =>
            reject(new Error("Falha ao carregar o script do Apps Script."));
          document.head.appendChild(script);
        });
      }

      // IMPORTANTE: SUBSTITUA ESTE URL PELA URL DO SEU GOOGLE APPS SCRIPT WEB APP
      // VOCÊ OBTERÁ ESTE URL APÓS IMPLANTAR SEU PROJETO APPS SCRIPT (ver passo 5 abaixo)
      const APPS_SCRIPT_WEB_APP_URL =
        "https://script.google.com/macros/s/AKfycbxzklfRhvp6sEM8R2PFfWL5ThbrIDYs-jgGJP3tdiKptWk1ahTpxZz77MulJxmLND-q/exec";
      // Carrega o script do Apps Script ANTES do seu script principal
      // para garantir que google.script.run esteja disponível.
      loadAppsScriptAPI(APPS_SCRIPT_WEB_APP_URL)
        .then(() => {
          console.log("API do Apps Script carregada com sucesso.");
          // Agora, carregue o seu script.js
          const mainScript = document.createElement("script");
          mainScript.src = "script.js";
          document.body.appendChild(mainScript);
        })
        .catch((error) => {
          console.error("Erro ao inicializar o Apps Script API:", error);
          // Opcional: Mostrar uma mensagem de erro na UI
          document.getElementById(
            "messageContainer"
          ).textContent = `Erro crítico: Falha ao carregar o serviço do Apps Script (${error.message}). Por favor, verifique a URL e a implantação.`;
          document.getElementById("messageContainer").className =
            "message error";
          document.getElementById("messageContainer").style.display = "block";
        });
    </script>
  </body>
</html>
